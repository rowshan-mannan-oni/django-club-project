{% extends "base.html" %}

{% block title %}
Members – {{ club.name }}
{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">
    Members of {{ club.name }}
</h1>

<table class="min-w-full border text-center">
    <thead>
        <tr class="bg-gray-100">
            <th class="px-4 py-2 border">Username</th>
            <th class="px-4 py-2 border">Role</th>
            <th class="px-4 py-2 border">Joined At</th>
            <th class="px-4 py-2 border">Status</th>
        </tr>
    </thead>
    <tbody>
        {% for membership in memberships %}
        <tr class="{% if not membership.is_active %}bg-gray-50 text-gray-500{% endif %}">
            <td class="px-4 py-2 border">
                {{ membership.user.username }}
                {% if membership.user == request.user %}
                    <span class="text-xs text-gray-400">(you)</span>
                {% endif %}
            </td>

            <td class="px-4 py-2 border font-medium">
                {{ membership.get_role_display }}
            </td>

            <td class="px-4 py-2 border">
                {{ membership.joined_at|date:"F j, Y H:i" }}
            </td>

            <td class="px-4 py-2 border">
                {% if membership.is_active %}
                    <span class="text-green-600 font-semibold">Active</span>
                {% else %}
                    <span class="text-red-600 font-semibold">Inactive</span>
                {% endif %}
            </td>
            <td class="px-4 py-2 border">
                {% if membership.is_active and membership.role != Role.ADMIN and membership.user != request.user %}
                    <form method="post" action="{% url 'membership:change_role' club.slug membership.id %}" class="inline-block">
                        {% csrf_token %}
                        {% if membership.role == Role.MEMBER %}
                            <input type="hidden" name="action" value="promote">
                            <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                Promote
                            </button>
                        {% elif membership.role == Role.MODERATOR %}
                            <input type="hidden" name="action" value="demote">
                            <button type="submit" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600">
                                Demote
                            </button>
                        {% endif %}
                    </form>
                {% else %}
                    <span class="text-gray-400">—</span>
                {% endif %}
            </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="4" class="px-4 py-2 border text-center">
                No members found.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{% url 'club:club_detail' club.slug %}"
   class="text-blue-600 hover:underline mt-4 inline-block">
    ← Back to Club
</a>
{% endblock %}
